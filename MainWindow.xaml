<Window x:Class="MiniScreenPreview.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:MiniScreenPreview"
        xmlns:controls="clr-namespace:MiniScreenPreview.Controls"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}" Height="800" Width="1200"
        WindowStartupLocation="CenterScreen">
    <Window.InputBindings>
        <KeyBinding Gesture="Ctrl+N" Command="{x:Static local:MainWindow.NewProjectCommand}"/>
        <KeyBinding Gesture="Ctrl+O" Command="{x:Static local:MainWindow.OpenProjectCommand}"/>
        <KeyBinding Gesture="Ctrl+S" Command="{x:Static local:MainWindow.SaveProjectCommand}"/>
        <KeyBinding Gesture="Ctrl+Shift+S" Command="{x:Static local:MainWindow.SaveProjectAsCommand}"/>
        <KeyBinding Gesture="Alt+F4" Command="{x:Static local:MainWindow.ExitCommand}"/>
        <KeyBinding Gesture="F12" Command="{x:Static local:MainWindow.ShowAllInfoCommand}"/>
    </Window.InputBindings>
    <Window.Resources>
        <local:StringEqualityConverter x:Key="StringEqualityConverter"/>
        <Style x:Key="PropertyTextBoxStyle" TargetType="TextBox">
            <Setter Property="Height" Value="26"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="4,2"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="#CCCCCC"/>
            <Setter Property="Background" Value="White"/>
        </Style>
        <Style x:Key="PropertyNumericTextBoxStyle" TargetType="controls:NumericTextBox" BasedOn="{StaticResource PropertyTextBoxStyle}">
        </Style>
        <Style x:Key="PropertyComboBoxStyle" TargetType="ComboBox">
            <Setter Property="Height" Value="26"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Padding" Value="4,2"/>
        </Style>
        <Style x:Key="PropertySliderStyle" TargetType="Slider">
            <Setter Property="Height" Value="26"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>
        <Style x:Key="PropertyLabelStyle" TargetType="TextBlock">
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Medium"/>
            <Setter Property="Foreground" Value="#333333"/>
        </Style>
        <Style x:Key="PropertySectionStyle" TargetType="TextBlock" BasedOn="{StaticResource PropertyLabelStyle}">
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Foreground" Value="#555555"/>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#F0F0F0" BorderBrush="#D0D0D0" BorderThickness="0,0,0,1">
            <MenuItem Header="_File">
                <MenuItem Header="_New Project" Click="NewProject_Click" 
                          InputGestureText="Ctrl+N">
                    <MenuItem.Icon>
                        <TextBlock Text="📄" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="_Open Project..." Click="OpenProject_Click" 
                          InputGestureText="Ctrl+O">
                    <MenuItem.Icon>
                        <TextBlock Text="📂" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Save Project" Click="SaveProject_Click" 
                          InputGestureText="Ctrl+S">
                    <MenuItem.Icon>
                        <TextBlock Text="💾" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Save Project _As..." Click="SaveProjectAs_Click" 
                          InputGestureText="Ctrl+Shift+S">
                    <MenuItem.Icon>
                        <TextBlock Text="💾" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="_Close Project" Click="CloseProject_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="✖️" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="E_xit" Click="Exit_Click" 
                          InputGestureText="Alt+F4">
                    <MenuItem.Icon>
                        <TextBlock Text="🚪" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
            
            <MenuItem Header="_View">
                <MenuItem Header="Show _All Info" Click="ShowAllInfo_Click" 
                          InputGestureText="F12">
                    <MenuItem.Icon>
                        <TextBlock Text="ℹ️" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Show Selection _Border" IsCheckable="True" 
                          IsChecked="{Binding ShowSelectionBorder}">
                    <MenuItem.Icon>
                        <Border Width="12" Height="12" BorderThickness="1" BorderBrush="Gray" Background="Transparent"/>
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="No Selection _Border" IsCheckable="True" 
                          IsChecked="{Binding ShowSelectionBorder, Converter={x:Static local:BooleanConverter.Inverted}}">
                    <MenuItem.Icon>
                        <Border Width="12" Height="12" BorderThickness="1" BorderBrush="Gray" Background="Transparent"/>
                    </MenuItem.Icon>
                </MenuItem>
                <Separator/>
                <MenuItem Header="Border _Color">
                    <MenuItem.Icon>
                        <TextBlock Text="🎨" FontSize="12"/>
                    </MenuItem.Icon>
                    <MenuItem Header="_Red" IsCheckable="True"
                              IsChecked="{Binding SelectionBorderColor, Converter={StaticResource StringEqualityConverter}, ConverterParameter=Red}"
                              Click="SetBorderColor_Click" Tag="Red">
                        <MenuItem.Icon>
                            <Ellipse Width="12" Height="12" Fill="Red"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="_Green" IsCheckable="True"
                              IsChecked="{Binding SelectionBorderColor, Converter={StaticResource StringEqualityConverter}, ConverterParameter=Green}"
                              Click="SetBorderColor_Click" Tag="Green">
                        <MenuItem.Icon>
                            <Ellipse Width="12" Height="12" Fill="Green"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="_Blue" IsCheckable="True"
                              IsChecked="{Binding SelectionBorderColor, Converter={StaticResource StringEqualityConverter}, ConverterParameter=Blue}"
                              Click="SetBorderColor_Click" Tag="Blue">
                        <MenuItem.Icon>
                            <Ellipse Width="12" Height="12" Fill="Blue"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
            </MenuItem>
            
            <MenuItem Header="_Help">
                <MenuItem Header="_About" Click="About_Click">
                    <MenuItem.Icon>
                        <TextBlock Text="❓" FontSize="12"/>
                    </MenuItem.Icon>
                </MenuItem>
            </MenuItem>
        </Menu>
        
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="250"/>
            </Grid.ColumnDefinitions>

        <!-- Left Panel - Image List -->
        <Border Grid.Column="0" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <TextBlock Grid.Row="0" Text="Image Resources" Style="{StaticResource PropertySectionStyle}" Margin="12,12,12,8"/>

                <ListBox Grid.Row="1" x:Name="ImageListBox" 
                         ItemsSource="{Binding ImageResources}"
                         SelectedItem="{Binding SelectedImageResource}"
                         Margin="10"
                         AllowDrop="True"
                         DragEnter="ImageListBox_DragEnter"
                         DragOver="ImageListBox_DragOver"
                         Drop="ImageListBox_Drop">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                
                                <CheckBox Grid.Column="0" IsChecked="{Binding IsVisible}" Margin="0,0,5,0"/>
                                <TextBlock Grid.Column="1" Text="{Binding Name}" VerticalAlignment="Center"/>
                                <TextBlock Grid.Column="2" Text="{Binding Layer}" 
                                          Background="DarkBlue" Foreground="White" 
                                          Padding="4,2" FontSize="10" VerticalAlignment="Center"/>
                            </Grid>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>

                <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center" Margin="12">
                    <Button Content="Add Image" Command="{Binding AddImageCommand}" 
                            Height="32" Padding="12,6" FontWeight="Medium"
                            Background="#4CAF50" Foreground="White" BorderBrush="#45A049"
                            Margin="0,0,8,0"/>
                    <Button Content="Remove" Command="{Binding RemoveImageCommand}"
                            Height="32" Padding="12,6" FontWeight="Medium"
                            Background="#F44336" Foreground="White" BorderBrush="#D32F2F"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Center Panel - Preview Area -->
        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Preview Controls -->
            <Border Grid.Row="0" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="0,0,0,1" Padding="10">
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                    <TextBlock Text="Presets:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,8,0"/>
                    <ComboBox ItemsSource="{Binding SizePresets}" 
                              SelectedItem="{Binding SelectedSizePreset}"
                              Style="{StaticResource PropertyComboBoxStyle}"
                              Width="100" Margin="0,0,15,0"/>
                    
                    <TextBlock Text="Size:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,8,0"/>
                    <TextBox Text="{Binding PreviewWidth, UpdateSourceTrigger=PropertyChanged}" 
                             Style="{StaticResource PropertyTextBoxStyle}"
                             Width="60" Margin="0,0,4,0"/>
                    <TextBlock Text="×" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,4,0"/>
                    <TextBox Text="{Binding PreviewHeight, UpdateSourceTrigger=PropertyChanged}" 
                             Style="{StaticResource PropertyTextBoxStyle}"
                             Width="60" Margin="0,0,15,0"/>
                    
                    <TextBlock Text="Zoom:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,8,0"/>
                    <Slider Value="{Binding ZoomLevel}" Minimum="0.1" Maximum="3.0" 
                            Style="{StaticResource PropertySliderStyle}"
                            Width="120" Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding ZoomLevel, StringFormat={}{0:F1}×}" Style="{StaticResource PropertyLabelStyle}"/>
                </StackPanel>
            </Border>

            <!-- Preview Canvas -->
            <controls:PreviewCanvas Grid.Row="1" Margin="10" 
                                   DataContext="{Binding}" 
                                   Focusable="True"/>

            <!-- Status Bar -->
            <StatusBar Grid.Row="2">
                <StatusBarItem>
                    <TextBlock Text="{Binding ImageResources.Count, StringFormat='Images: {0}'}"/>
                </StatusBarItem>
                <StatusBarItem>
                    <TextBlock Text="{Binding SelectedImageResource.Name, StringFormat='Selected: {0}'}"/>
                </StatusBarItem>
            </StatusBar>
        </Grid>

        <!-- Right Panel - Properties -->
        <Border Grid.Column="2" Background="#F8F8F8" BorderBrush="#E0E0E0" BorderThickness="1,0,0,0">
            <ScrollViewer>
                <StackPanel Margin="12" IsEnabled="{Binding SelectedImageResource, Converter={x:Static local:BooleanConverter.IsNotNull}}">
                    <TextBlock Text="Properties" Style="{StaticResource PropertySectionStyle}" Margin="0,0,0,12"/>

                    <TextBlock Text="Name:" Style="{StaticResource PropertyLabelStyle}" Margin="0,8,0,4"/>
                    <TextBox Text="{Binding SelectedImageResource.Name, UpdateSourceTrigger=PropertyChanged}" 
                             Style="{StaticResource PropertyTextBoxStyle}"/>

                    <TextBlock Text="Image Size:" Style="{StaticResource PropertyLabelStyle}" Margin="0,12,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <TextBlock Text="{Binding SelectedImageResource.ImageSource.PixelWidth}" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,3,0"/>
                        <TextBlock Text="×" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,3,0"/>
                        <TextBlock Text="{Binding SelectedImageResource.ImageSource.PixelHeight}" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,6,0"/>
                        <TextBlock Text="px" Foreground="#999999" VerticalAlignment="Center"/>
                    </StackPanel>

                    <TextBlock Text="Position X:" Style="{StaticResource PropertyLabelStyle}" Margin="0,12,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <controls:NumericTextBox Value="{Binding SelectedImageResource.X}" 
                                                Step="1" Minimum="-360" Maximum="360"
                                                Style="{StaticResource PropertyNumericTextBoxStyle}"
                                                Width="70" Margin="0,0,8,0"/>
                        <Slider Value="{Binding SelectedImageResource.X}" 
                                Minimum="-360" Maximum="360" 
                                Style="{StaticResource PropertySliderStyle}"
                                Width="140" SmallChange="1" LargeChange="10"/>
                    </StackPanel>

                    <TextBlock Text="Position Y:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <controls:NumericTextBox Value="{Binding SelectedImageResource.Y}" 
                                                Step="1" Minimum="-360" Maximum="360"
                                                Style="{StaticResource PropertyNumericTextBoxStyle}"
                                                Width="70" Margin="0,0,8,0"/>
                        <Slider Value="{Binding SelectedImageResource.Y}" 
                                Minimum="-360" Maximum="360" 
                                Style="{StaticResource PropertySliderStyle}"
                                Width="140" SmallChange="1" LargeChange="10"/>
                    </StackPanel>

                    <TextBlock Text="Scale:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <controls:NumericTextBox Value="{Binding SelectedImageResource.Scale}" 
                                                Step="0.01" Minimum="0.1" Maximum="3.0"
                                                Style="{StaticResource PropertyNumericTextBoxStyle}"
                                                Width="70" Margin="0,0,8,0"/>
                        <Slider Value="{Binding SelectedImageResource.Scale}" 
                                Minimum="0.1" Maximum="3.0" 
                                Style="{StaticResource PropertySliderStyle}"
                                Width="140" SmallChange="0.01" LargeChange="0.1"/>
                    </StackPanel>

                    <TextBlock Text="Layer:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <controls:NumericTextBox Value="{Binding SelectedImageResource.Layer}" 
                                                Step="1" Minimum="0" Maximum="999"
                                                Style="{StaticResource PropertyNumericTextBoxStyle}"
                                                Width="70" Margin="0,0,8,0"/>
                        <StackPanel Orientation="Horizontal">
                            <Button Content="↑" Width="32" Height="26" Click="MoveLayerDown_Click" Margin="0,0,2,0"/>
                            <Button Content="↓" Width="32" Height="26" Click="MoveLayerUp_Click"/>
                        </StackPanel>
                    </StackPanel>

                    <TextBlock Text="Opacity:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,8">
                        <controls:NumericTextBox Value="{Binding SelectedImageResource.Opacity}" 
                                                Step="0.01" Minimum="0" Maximum="1"
                                                FormatMode="percent"
                                                Style="{StaticResource PropertyNumericTextBoxStyle}"
                                                Width="70" Margin="0,0,8,0"/>
                        <Slider Value="{Binding SelectedImageResource.Opacity}" 
                                Minimum="0" Maximum="1" 
                                Style="{StaticResource PropertySliderStyle}"
                                Width="110" SmallChange="0.01" LargeChange="0.1"/>
                        <TextBlock Text="%" Style="{StaticResource PropertyLabelStyle}" Margin="8,0,0,0"/>
                    </StackPanel>

                    <TextBlock Text="Rotation:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,4"/>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,12">
                        <controls:NumericTextBox Value="{Binding SelectedImageResource.Rotation}" 
                                                Step="1" Minimum="0" Maximum="360"
                                                Style="{StaticResource PropertyNumericTextBoxStyle}"
                                                Width="70" Margin="0,0,8,0"/>
                        <Slider Value="{Binding SelectedImageResource.Rotation}" 
                                Minimum="0" Maximum="360" 
                                Style="{StaticResource PropertySliderStyle}"
                                Width="110" SmallChange="1" LargeChange="15"/>
                        <TextBlock Text="°" Style="{StaticResource PropertyLabelStyle}" Margin="8,0,0,0"/>
                    </StackPanel>

                    <CheckBox Content="Visible" IsChecked="{Binding SelectedImageResource.IsVisible}" 
                              VerticalAlignment="Center" FontWeight="Medium" Foreground="#333333"
                              Margin="0,0,0,15"/>

                    <Button Content="Reset Properties" Click="ResetProperties_Click" 
                            Height="32" Padding="12,6" 
                            Background="#FF6B35" Foreground="White" BorderBrush="#E55A2B"
                            FontWeight="Medium"
                            ToolTip="Reset position, scale, rotation, opacity to default values"
                            Margin="0,0,0,8"/>
                    
                    <Button Content="Show All Info" Click="ShowAllInfo_Click" 
                            Height="32" Padding="12,6" 
                            Background="#2196F3" Foreground="White" BorderBrush="#1976D2"
                            FontWeight="Medium"
                            ToolTip="Display all project information with copy option"
                            Margin="0,0,0,15"/>

                    <TextBlock Text="File Path:" Style="{StaticResource PropertyLabelStyle}" Margin="0,0,0,4"/>
                    <TextBox Text="{Binding SelectedImageResource.FilePath}" 
                             IsReadOnly="True" TextWrapping="Wrap" 
                             Background="#F0F0F0" Foreground="#666666"
                             MinHeight="26" MaxHeight="80"
                             VerticalContentAlignment="Top"
                             VerticalScrollBarVisibility="Auto"
                             Padding="4,4"
                             BorderThickness="1" BorderBrush="#CCCCCC"/>
                </StackPanel>
            </ScrollViewer>
        </Border>
        </Grid>
    </Grid>
</Window>
